---
title: 移动和调整 linux 分区
date: 2024-04-11
tags:
 - linux
 - fedora
 - ubuntu
 - partition
 - gparted
categories: os
---

我的 PC 最初只有一块 475 GiB 的固态硬盘，下载的文件和媒体资料占用了大量磁盘空间，但又不经常使用，
于是我购入一块 1TB 的西数移动机械硬盘作为这些“冷”文件的存储介质。
后来又购入一块 1TB 的东芝机械硬盘，安装在预留的槽位，代替移动硬盘存储媒体资料，移动硬盘仅存放下载的文件，如各种安装包。

由于 Windows 实在太难用但又有用，想要切换到 linux 系统。
最初的选择是安装双系统，在固态硬盘上同时安装了 Windows 和 mint ubuntu 等，体验还行。
可能安装在同一硬盘的缘故，每次使用 linux 后切换到 Windows 都会风扇呼呼作响，似乎在校验文件？
索性移除了 linux 。
但是 linux 让我迷恋，几天之后又在东芝盘上安装了 fedora ，给了我全新的桌面体验。
但是一块硬盘装两个系统（东芝前半部分是 ntfs ）感觉欠佳，使用没多久又删除了 fedora 。

后来翻倒西数硬盘时，觉得装载一个 linux 系统。
起先我给西数盘划分了四分之一的空间安装 fedora ，安装并配置完成后，觉得不错。
之后猛然想到，东芝盘足够大的，完全可以装入所有的文件，西数盘可以完全用于 linux ，实现一个移动系统。
（在此期间我还认识了计算机启动的过程）

于是将西数盘的数据导入东芝盘后，抹除了西数盘的数据。此时问题出现了。

由于安装 fedora 是从西数盘划分出一部分空间，它是在磁盘右边的。现在抹除数据后，磁盘左边多出来一大块未分配空间。
如果在该空间创建一个分区挂载到某个目录下也是可以的，但总觉得不舒服。我想要的是将该空间“合并”到主分区。
（磁盘 disk 、分区 partition 的概念就是在这期间理解的，之前完全没有头绪，连基本术语都不了解）
查阅诸多资料，有关无关、中文英文……包括分区扩容、分重新划分、分区移动、分区合并等关键词。
最后找到一篇回答：
[ubuntu 怎么向左扩展分区？](https://www.zhihu.com/question/395556018/answer/1256067737)

在此之前，曾有一个方案是 umount 根目录分区然后重新划分，但是在当前系统是无法 umount 根目录的。
接着一个方案是使用 live CD ，是一种在光盘里使用的 linux （此处概念不准确）。
考虑到 fedora workstation 自带临时使用功能，没有安装 live CD 。

回到上文，参考回答中的方法，找到一个 ubuntu 20 系统启动，选择 try 然后使用其中的 GParted 程序调整分区。
这里又遇到一个问题。

fedora 安装完成后磁盘里有 3 个分区，一个是 EFI 引导分区，
一个不知道，占用 1GB 磁盘空间，使用 ext4 文件系统，
还有一个就是主分区。
使用 GParted 成功将第一个分区移动到磁盘最左，移动第二个分区时遇到错误

```
/dev/sdb2 has unsupported features(s): FEATURE_C12
e2fsck: Get a newer version of e2fsck!
...
```

查找报错原因，无果。
看到 `newer version` 猜测是否是 `e2fsck` 版本太低了？下面还显示是 2020 年的版本。
`which e2fsck` 得到 `/usr/sbin/e2fsck` ， apt 不能升级。

于是改用 ubuntu 22 尝试， e2fsck 是 2021 年的版本，仍然失败。

想了想，可能是 fedora 版本太高了，我使用的是最新的 39 版。
决定用 fedora workstation 再尝试一下，它自身没有 gparted ，
联网安装最新的 gparted ，仍然无法移动第二个分区。
但是与之前不同的是，第二个和第三个分区名字后面都带了一个“锁”的图标。

查阅 bing gparted 不能移动分区，第一条内容有一句话：
大多数linux分区后面都有一个钥匙的标志，表示已经挂载，所以要先取消挂载……

果然，取消挂载后成功移动了后两个分区。由于主分区已经写入很多内容，移动完成花费将近 2 个小时。
（这里有一个疑问，为什么这俩分区被挂载了？）

**总结**

linux 分区的移动与调整需要在另一个 linux 系统上进行，使用 gparted 工具，取消挂载需要调整的分区，然后
`resize/move` 。
