---
title: 正则笔记
date: 2023-09-04
draft: true
tags:
 - regex
categories: computer
---


正则表达式（regular expression）是一个模式匹配典例，正则引擎可以根据模式串从目标串中
匹配、查找、替换、提取，是字符串处理的强大工具。


<!--more-->


写在前面：爬虫入门教程有很多用正则表达式解析数据，这么做没有问题，但是对于 HTML 和 JSON 等结构化文本，
用对应的解析引擎更合适。工具要趁手，但更要合适。

本文是正则表达式学习笔记，知识来源网络。
这里标记 zjmainstay 的[深入理解正则表达式高级教程](http://www.zjmainstay.cn/deep-regexp)
以及在线正则网站 [嗨正则](https://hiregex.com/)，是我学习正则的重要资料和工具。

另外，网传著名的动物书《精通正则表达式》似乎值得一读，但是我还没有开始。

## 正则的历史背景

## 正则四大件

以我目前学习程度，我将正则表达式分为 4 部分，称为四大件：字符、量词、分组、断言。

以上按照从易到难排列，掌握字符、量词就可以应对很多情景了。

### 字符

字符是组成字符串的基本元素，也是正则的基础。

字符包括普通字符与元字符，不混淆的情况下普通字符简称字符，不是元字符的都是普通字符。
元字符是特殊的字符，具有特殊含义或特殊功能。

字符一般意义上指的是语法上单个的符号，但是正则的元字符是语义上的“单个”符号，
例如 `[abcd]` 在语法上包含 6 个符号，但在正则语义中它是 1 个符号，
表示一个字符类。

还有一点可能存在争议，例如 `^` `$\$$` `\b` `*` `+` `?` 这些零宽度的符号是否属于元字符，
我认为它们不是，因为元字符首先是字符，要求宽度为 1（语义宽度）。
当然，存在争议就存在多种说法，各有各自的理由，不论对错，但本文坚持我的观点。

因为没有系统阅读正则表达式相关书籍，不知道到底有多少元字符，所有不敢说元字符有哪些，
只敢说常用的有哪些。

第一个是匹配范围最广泛的元字符 `.`，它可以匹配除了换行符 `\n` 以外的所有字符，应用十分广泛。

第二个是前面提到的字符类 `[]`，由一对方括号包含，方括号之间填写想要匹配的字符。
例如我想匹配字母 `x`, `y` and `z`，可以这么写 `[xyz]`。
对于连续字符集合，可以用连字符简化，例如我想匹配所有数字，可以写 `[0123456789]`，
但更方便的写法是 `[0-9]`，同理我想匹配上面的三个字母，可以写作 `[x-z]`，匹配所有字母，
可以写作 `[a-zA-Z]`，匹配数字和字母，可以写作 `[a-z0-9A-Z]`。
只要保证每个范围合法，范围的顺序不影响。

第三个是字符类的补集 `[^]`，表示匹配除了方括号之间字符的所有字符（不包括 `^`）。
例如我想匹配所有非数字字符，`[^0-9]`。

其它的常用元字符多是以 `\` 加一个大写或小写的字母组成，而且大小写字母的元字符互为补集，包括

|字符|含义|
|--|:--:|
| `\d`| 匹配 0-9 所有数字字符，等价于 `[0-9]`|
| `\D`| 匹配所有非数字字符，等价于 `[^0-9]` 或者 `[^\d]`|
| `\w`| 等价于 `[a-zA-Z_]`|
| `\W`||
| `\s`| 匹配空白符，包括空格、制表符 `\t`、换行符 `\n`|
| `\S`||

还有一类元字符，格式 `[[:x:]]`，包括

|字符|含义|字符|含义|
|--|:--:|--|:--:|
| `[[:alnum:]]` | 等价于 `[0-9a-zA-Z]`| `[[:alpha:]]` | 等价于 `[a-zA-Z]`|
| `[[:ascii:]]` | 匹配 ASCII 0-127| `[[:digit:]]` | 匹配十进制数字|
| `[[:cntrl:]]` | 匹配控制符|
| `[[:graph:]]` | 匹配可见字符（不包含空白符）| `[[:print:]]` | 匹配可打印字符（包含空白符）|
| `[[:space:]]` | 匹配空白字符| `[[:blank:]]` | 匹配空格或制表符|
| `[[:lower:]]` | 匹配小写字母| `[[:upper:]]` | 匹配大写字母|
| `[[:word:]]`  | 匹配单词字符| `[[:xdigit:]]`| 匹配十六进制数字|

元字符向普通字符转换需要一个转义符 `\`，包括后面的部分量词、分组想要作为普通字符也需要转义。

### 量词

### 分组

### 断言

---

正则表达式是初级的模式匹配，在字符串处理中有很重要的作用。

> 对于结构化文本，如 HTML XML JSON 等，使用对应的解析器更方便。
> 正则表达式更适用于非结构化文本，如自然语言段落。

<!--more-->

## 字符

使用正则表达式要与各种字符串打交道，主要是元字符、一般字符、限定符等。

### 元字符

元字符是一个字符模式，用于匹配符合该模式的字符。包括匹配字符和匹配位置两种。

匹配字符

-   `.` 换行符以外的所有字符
-   `\w` 字母、空格、下划线 `\W` 补集
-   `\s` 空格、制表符、换行符 `\S` 补集
-   `\d` 数字 `\D` 补集

匹配位置

-   `^`
-   `$`
-   `\b`

### 字符

一般字符简称字符，就是字面量。

字符类

-   `[string]` 匹配一个字符
-   `[^string]` 补集

转义字符

-   `\`

### 限定符

限定符就是量词。

-   `{n}` 重复 n 次
-   `{n,}` 至少重复 n 次
-   `{n,m}`
-   `*` 重复 0 次或多次
-   `+` 重复 1 次或多次
-   `?` 0 次或 1 次
-   `x?` 非贪婪匹配，x 表示以上限定符

## 运算

替换 `a|b`

分组 `(x)`

反向引用：分组从左到右遇到左括号开始从 1 编号，`\1`（有些地方使用 `$1`）引用第一个分组，不必重复编写。
只作为整体，不希望编号：`(?:x)`

常用分组

-   正向先行断言 `(?=x)`
-   负向先行断言 `(?!x)`
-   正向后行断言 `(?<=x)`
-   负向后行断言 `(?<!x)`
-   `(?>x)`

> 正向：是它；先行：后面；正向先行：后面是它。

（零宽）断言

-   `^` `$`
-   `\A`
-   `\z` `\Z`
-   `\G`
-   `\b` `\B`

优先级

1. 转义符 `\`
2. 圆括号和方括号
   `()` `(?:)` `(?=)` `[]`
3. 限定符
4. 位置和顺序
   `^` `$` 元字符
5. 或运算 `|`
